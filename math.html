<!doctype html>
<html lang="ja" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>æ•°å¼æç”»ãƒ„ãƒ¼ãƒ«ï¼ˆLaTeXå…¥åŠ› & ãƒœã‚¿ãƒ³ç”Ÿæˆï¼‰</title>
  <style>
    :root{ --bg:#0b1020; --card:#121834; --muted:#9fb0ff; --text:#e9ecff; --btn:#1e2959; --btnh:#2a3879 }
    [data-theme="light"]{ --bg:#f6f8ff; --card:#ffffff; --muted:#5264b8; --text:#0f172a; --btn:#e7eeff; --btnh:#d9e4ff }
    body{margin:0;background:var(--bg);color:var(--text);font:16px/1.6 system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,"Hiragino Kaku Gothic ProN","Noto Sans JP"}
    .wrap{max-width:1000px;margin:40px auto;padding:0 16px}
    h1{font-size:clamp(20px,4vw,30px);margin:0 0 12px}
    .card{background:color-mix(in oklab, var(--card) 92%, transparent);border:1px solid color-mix(in oklab, var(--text) 12%, transparent);border-radius:14px;padding:18px;margin:14px 0}
    textarea{width:100%;min-height:140px;border-radius:10px;background:color-mix(in oklab, var(--bg) 92%, white 0%);color:var(--text);border:1px solid color-mix(in oklab, var(--text) 20%, transparent);padding:10px;font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace}
    .btn{appearance:none;border:0;border-radius:10px;padding:8px 12px;background:var(--btn);color:var(--text);font-size:14px;cursor:pointer}
    .btn:hover{background:var(--btnh)}
    .toolbar{display:flex;flex-wrap:wrap;gap:6px;margin:6px 0}
    .toolbar .group{display:flex;flex-wrap:wrap;gap:6px}
    .tabbar{display:flex;gap:8px;flex-wrap:wrap}
    .tab{padding:6px 10px;border-radius:999px;border:1px solid color-mix(in oklab, var(--text) 18%, transparent);cursor:pointer;background:transparent}
    .tab.active{background:color-mix(in oklab, var(--text) 10%, transparent)}
    .muted{color:var(--muted);font-size:13px}
    .actionbar{margin-top:10px;display:flex;gap:8px;flex-wrap:wrap}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .pill{padding:6px 10px;border-radius:999px;border:1px solid color-mix(in oklab, var(--text) 18%, transparent);background:transparent}
    .kbd{display:inline-block;padding:1px 6px;border-radius:6px;border:1px solid color-mix(in oklab, var(--text) 25%, transparent);font-size:12px}
    .output{background:color-mix(in oklab, var(--bg) 92%, white 0%);padding:10px;border-radius:10px;overflow:auto;font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace}
    .hist{display:flex;gap:8px;flex-wrap:wrap}
    .chip{border:1px solid color-mix(in oklab, var(--text) 18%, transparent);padding:6px 8px;border-radius:999px;background:transparent;cursor:pointer}
    .chip:hover{background:color-mix(in oklab, var(--text) 10%, transparent)}
    .tooltip{position:relative}
    .tooltip:hover::after{content:attr(data-tip);position:absolute;left:50%;bottom:120%;transform:translateX(-50%);background:#000c;color:#fff;padding:4px 6px;border-radius:8px;white-space:nowrap;font-size:12px}
  </style>
  <script>
    // MathJaxï¼ˆSVGå‡ºåŠ›ï¼‰
    window.MathJax = { tex:{inlineMath:[["$","$"],["\(","\)"]]}, svg:{fontCache:'local'} };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
</head>
<body>
  <div class="wrap">
    <div class="row" style="justify-content:space-between">
      <h1>æ•°å¼æç”»ãƒ„ãƒ¼ãƒ«</h1>
      <div class="row">
        <button id="themeToggle" class="btn">ğŸŒ— ãƒ†ãƒ¼ãƒ</button>
        <a class="btn" href="index.html">â† PDFãƒ„ãƒ¼ãƒ«ã¸</a>
      </div>
    </div>
    <p class="muted">ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã‹ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ› â†’ å³æ™‚ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã€‚<span class="kbd">âŒ˜/Ctrl</span>+<span class="kbd">Enter</span>ã§æç”»ã€<span class="kbd">âŒ˜/Ctrl</span>+<span class="kbd">C</span>ã§ã‚³ãƒ”ãƒ¼ã€‚</p>

    <div class="card">
      <div class="row">
        <label class="pill"><input type="checkbox" id="displayMode" checked style="accent-color:#6aa9ff"/> $$ ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤è¡¨ç¤º</label>
        <label class="pill"><input type="checkbox" id="autoRender" checked style="accent-color:#6aa9ff"/> å…¥åŠ›ã§è‡ªå‹•æç”»</label>
      </div>

      <div class="tabbar" id="tabbar"></div>
      <div class="toolbar" id="toolbar"></div>

      <textarea id="input" placeholder="ä¾‹ï¼š\int_0^1 x^2\,dx = 
\frac{a+b}{2} 
\sum_{n=1}^N n"></textarea>
      <div class="actionbar">
        <button id="render" class="btn">æç”»</button>
        <button id="copy" class="btn">TeXã‚³ãƒ”ãƒ¼</button>
        <button id="copyWrapped" class="btn tooltip" data-tip="$$...$$ ã§åŒ…ã‚“ã§ã‚³ãƒ”ãƒ¼">$$ ã§ã‚³ãƒ”ãƒ¼</button>
        <button id="saveSvg" class="btn">SVGä¿å­˜</button>
        <button id="savePng" class="btn">PNGä¿å­˜</button>
        <button id="shareUrl" class="btn">URLå…±æœ‰</button>
        <button id="clear" class="btn">ã‚¯ãƒªã‚¢</button>
      </div>
      <p class="muted" style="margin-top:6px">ãƒ’ãƒ³ãƒˆï¼šãƒ†ã‚­ã‚¹ãƒˆã‚’é¸æŠã—ã¦ã‹ã‚‰ <b>åˆ†æ•°/âˆš/æ‹¬å¼§</b> ã‚’æŠ¼ã™ã¨ã€é¸æŠã‚’ä¸­ã«å…¥ã‚Œã¦ãã‚Œã¾ã™ã€‚</p>
    </div>

    <div class="card">
      <h3>ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h3>
      <div id="preview" class="output">ï¼ˆã“ã“ã«æ•°å¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰</div>
    </div>

    <div class="card">
      <h3>ã‚³ãƒ¼ãƒ‰å‡ºåŠ›</h3>
      <div id="output" class="output"></div>
    </div>

    <div class="card">
      <h3>æœ€è¿‘ã®æ•°å¼ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ï¼‰</h3>
      <div id="history" class="hist"></div>
    </div>
  </div>

  <script>
    // ====== ãƒ„ãƒ¼ãƒ«ãƒãƒ¼åˆ†é¡ ======
    const GROUPS = {
      'åŸºæœ¬': [
        {l:'åˆ†æ•°', i:'\frac{}{}'}, {l:'âˆš', i:'\sqrt{}'},
        {l:'^ ä¸Š', i:'^{ }'}, {l:'_ ä¸‹', i:'_{ }'},
        {l:'( )', i:'\left(  \right)'}, {l:'[ ]', i:'\left[  \right]'}, {l:'{ }', i:'\left\{  \right\}'},
        {l:'| |', i:'\left|  \right|'}, {l:'ã€ˆã€‰', i:'\langle  \rangle'}
      ],
      'æ¼”ç®—å­': [
        {l:'âˆ«', i:'\int'}, {l:'âˆ‘', i:'\sum'}, {l:'âˆ', i:'\prod'},
        {l:'lim', i:'\lim'}, {l:'â†’', i:'\rightarrow'}, {l:'â‡’', i:'\Rightarrow'}, {l:'â†¦', i:'\mapsto'},
        {l:'â‰ˆ', i:'\approx'}, {l:'â‰ƒ', i:'\simeq'}, {l:'â‰¡', i:'\equiv'}, {l:'â‰¤', i:'\leq'}, {l:'â‰¥', i:'\geq'}
      ],
      'ã‚®ãƒªã‚·ãƒ£': [
        {l:'Î±', i:'\alpha'}, {l:'Î²', i:'\beta'}, {l:'Î³', i:'\gamma'}, {l:'Î´', i:'\delta'}, {l:'Îµ', i:'\epsilon'},
        {l:'Î¸', i:'\theta'}, {l:'Î»', i:'\lambda'}, {l:'Î¼', i:'\mu'}, {l:'Î½', i:'\nu'}, {l:'Î¾', i:'\xi'},
        {l:'Ï€', i:'\pi'}, {l:'Ï', i:'\rho'}, {l:'Ïƒ', i:'\sigma'}, {l:'Ï„', i:'\tau'}, {l:'Ï†', i:'\phi'}, {l:'Ï‰', i:'\omega'}
      ],
      'æ§‹é€ ': [
        {l:'è¡Œåˆ—2x2', i:'\begin{bmatrix}  &  \  &  \end{bmatrix}'},
        {l:'è¡Œåˆ—3x3', i:'\begin{bmatrix}  &  &  \  &  &  \  &  &  \end{bmatrix}'},
        {l:'cases', i:'\begin{cases}  , & \\  , &  \end{cases}'},
        {l:'åˆ†æ•°ã®å’Œ', i:'\frac{a}{b}+\frac{c}{d}'}, {l:'ãƒ†ã‚¤ãƒ©ãƒ¼', i:'\sum_{n=0}^{\infty} \frac{f^{(n)}(a)}{n!}(x-a)^n'}
      ],
      'ãƒ™ã‚¯ãƒˆãƒ«': [
        {l:'âˆ‚', i:'\partial'}, {l:'âˆ‡', i:'\nabla'}, {l:'â†’ãƒ™ã‚¯ãƒˆãƒ«', i:'\vec{}'}, {l:'ä¸Šç·š', i:'\overline{}'}, {l:'ãƒãƒƒãƒˆ', i:'\hat{}'}
      ]
    };

    const tabbar = document.getElementById('tabbar');
    const toolbar = document.getElementById('toolbar');
    const input = document.getElementById('input');
    const preview = document.getElementById('preview');
    const output = document.getElementById('output');
    const displayMode = document.getElementById('displayMode');

    // ã‚¿ãƒ–ç”Ÿæˆ
    const tabs = Object.keys(GROUPS);
    let activeTab = tabs[0];
    function renderTabs(){
      tabbar.innerHTML='';
      tabs.forEach(t=>{
        const b=document.createElement('button'); b.className='tab'+(t===activeTab?' active':''); b.textContent=t; b.addEventListener('click',()=>{activeTab=t; renderToolbar(); renderTabs();}); tabbar.appendChild(b);
      });
    }
    function renderToolbar(){
      toolbar.innerHTML='';
      const g = GROUPS[activeTab];
      const box = document.createElement('div'); box.className='group';
      g.forEach(k=>{ const b=document.createElement('button'); b.className='btn tooltip'; b.textContent=k.l; b.dataset.insert=k.i; b.dataset.tip=k.i; box.appendChild(b); });
      toolbar.appendChild(box);
    }
    renderTabs(); renderToolbar();

    // ãƒœã‚¿ãƒ³æŒ¿å…¥ï¼ˆé¸æŠã‚’åŒ…ã‚€ï¼‰
    toolbar.addEventListener('click', (e)=>{
      const btn = e.target.closest('button.btn'); if(!btn) return;
      insertTemplate(btn.dataset.insert);
    });

    function insertTemplate(tpl){
      const s=input.selectionStart, e=input.selectionEnd; const sel=input.value.slice(s,e);
      let ins = tpl;
      const wrap = (pre,post)=> pre+(sel||' ')+post;
      if(tpl==='\frac{}{}') ins = `\frac{${sel||' '}}{ }`;
      else if(tpl==='\sqrt{}') ins = wrap('\sqrt{','}');
      else if(tpl==='^{ }') ins = `{${sel||''}}^{ }`;
      else if(tpl==='_{ }') ins = `{${sel||''}}_{ }`;
      else if(tpl==='\left(  \right)') ins = wrap('\left(','\right)');
      else if(tpl==='\left[  \right]') ins = wrap('\left[','\right]');
      else if(tpl==='\left\{  \right\}') ins = wrap('\left\{','\right\}');
      else if(tpl==='\left|  \right|') ins = wrap('\left|','\right|');
      else if(tpl==='\langle  \rangle') ins = wrap('\langle ',' \rangle');
      else if(tpl==='\int') ins = `\int_{ }^{ } ${sel||''}\,`;
      else if(/\(vec|overline|hat)\{\}/.test(tpl)) ins = tpl.replace('{}',`{${sel||' '}}`);
      input.value = input.value.slice(0,s)+ins+input.value.slice(e);
      const pos = s+ins.length; input.focus(); input.selectionStart=input.selectionEnd=pos;
      if(document.getElementById('autoRender').checked) render();
    }

    // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
    function render(){
      const code = input.value;
      const body = displayMode.checked ? `$$${code}$$` : `\(${code}\)`;
      preview.innerHTML = body;
      MathJax.typesetPromise([preview]);
      output.textContent = code;
      saveHistory(code);
    }
    document.getElementById('render').addEventListener('click', render);
    document.getElementById('autoRender').addEventListener('change', ()=>{ if(document.getElementById('autoRender').checked) render(); });
    input.addEventListener('input', ()=>{ if(document.getElementById('autoRender').checked) render(); });

    // ã‚³ãƒ”ãƒ¼
    document.getElementById('copy').addEventListener('click',()=>{ navigator.clipboard.writeText(input.value).then(()=>toast('TeXã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ')); });
    document.getElementById('copyWrapped').addEventListener('click',()=>{
      const code = displayMode.checked ? `$$${input.value}$$` : `\(${input.value}\)`;
      navigator.clipboard.writeText(code).then(()=>toast('åŒ…ã‚“ã TeXã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ')); 
    });

    // ç”»åƒä¿å­˜
    async function currentSVG(){ await MathJax.typesetPromise([preview]); const svg=preview.querySelector('svg'); return svg? svg.outerHTML : null; }
    document.getElementById('saveSvg').addEventListener('click', async()=>{
      const svg=await currentSVG(); if(!svg) return; downloadBlob(new Blob([svg],{type:'image/svg+xml'}),'formula.svg');
    });
    document.getElementById('savePng').addEventListener('click', async()=>{
      const svg=await currentSVG(); if(!svg) return; const img=new Image(); const url=URL.createObjectURL(new Blob([svg],{type:'image/svg+xml'}));
      img.onload=()=>{ const scale=2; const c=document.createElement('canvas'); c.width=img.width*scale; c.height=img.height*scale; const ctx=c.getContext('2d'); ctx.setTransform(scale,0,0,scale,0,0); ctx.drawImage(img,0,0); c.toBlob(b=>{ if(b) downloadBlob(b,'formula.png'); URL.revokeObjectURL(url); },'image/png'); };
      img.src=url;
    });

    // URLå…±æœ‰ï¼ˆãƒãƒƒã‚·ãƒ¥ï¼‰
    function enc(s){return '#q='+encodeURIComponent(s)}
    function dec(){const m=location.hash.match(/^#q=(.*)$/);return m?decodeURIComponent(m[1]):''}
    document.getElementById('shareUrl').addEventListener('click',()=>{ const link=location.origin+location.pathname+enc(input.value); navigator.clipboard.writeText(link).then(()=>toast('å…±æœ‰URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ')); history.replaceState(null,'',enc(input.value)); });
    const q=dec(); if(q){ input.value=q; render(); }

    // å±¥æ­´
    const KEY='math-history-v2'; const histEl=document.getElementById('history');
    function loadHist(){ try{return JSON.parse(localStorage.getItem(KEY)||'[]')}catch{return[]} }
    function saveHistory(code){ if(!code||!code.trim()) return; const list=loadHist().filter(x=>x!==code); list.unshift(code); while(list.length>18) list.pop(); localStorage.setItem(KEY, JSON.stringify(list)); renderHist(); }
    function renderHist(){ const list=loadHist(); histEl.innerHTML=''; list.forEach(s=>{ const b=document.createElement('button'); b.className='chip'; b.textContent=s.length>28? s.slice(0,28)+'â€¦' : s; b.title=s; b.onclick=()=>{ input.value=s; render(); }; histEl.appendChild(b); }); }
    renderHist();

    // ã‚¯ãƒªã‚¢
    document.getElementById('clear').addEventListener('click',()=>{ input.value=''; preview.textContent='ï¼ˆã“ã“ã«æ•°å¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰'; output.textContent=''; toast('ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ'); });

    // ãƒ†ãƒ¼ãƒ
    const themeToggle=document.getElementById('themeToggle');
    function setTheme(t){ document.documentElement.setAttribute('data-theme', t); localStorage.setItem('theme', t); }
    const t0=localStorage.getItem('theme'); if(t0) setTheme(t0);
    themeToggle.addEventListener('click',()=>{ const cur=document.documentElement.getAttribute('data-theme')||'dark'; setTheme(cur==='dark'?'light':'dark'); });

    // util & ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
    function downloadBlob(blob, filename){ const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=filename; a.click(); setTimeout(()=>URL.revokeObjectURL(a.href), 1000); }
    function toast(msg){ const d=document.createElement('div'); d.textContent=msg; d.style.cssText='position:fixed;left:50%;bottom:24px;transform:translateX(-50%);background:#000b;color:#fff;padding:8px 12px;border-radius:10px;z-index:9999'; document.body.appendChild(d); setTimeout(()=>d.remove(),1400); }
    document.addEventListener('keydown',(ev)=>{ if((ev.metaKey||ev.ctrlKey)&&ev.key==='Enter'){ ev.preventDefault(); render(); } if((ev.metaKey||ev.ctrlKey)&&ev.key.toLowerCase()==='c'){ if(document.activeElement===input){ ev.preventDefault(); navigator.clipboard.writeText(input.value).then(()=>toast('TeXã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ')); } } });
  </script>
</body>
</html>
<!doctype html>
<html lang="ja" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>æ•°å¼æç”»ãƒ„ãƒ¼ãƒ«ï¼ˆLaTeXå…¥åŠ› & ãƒœã‚¿ãƒ³ç”Ÿæˆï¼‰</title>
  <style>
    :root{ --bg:#0b1020; --card:#121834; --muted:#9fb0ff; --text:#e9ecff; --btn:#1e2959; --btnh:#2a3879 }
    [data-theme="light"]{ --bg:#f6f8ff; --card:#ffffff; --muted:#5264b8; --text:#0f172a; --btn:#e7eeff; --btnh:#d9e4ff }
    body{margin:0;background:var(--bg);color:var(--text);font:16px/1.6 system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,"Hiragino Kaku Gothic ProN","Noto Sans JP"}
    .wrap{max-width:1000px;margin:40px auto;padding:0 16px}
    h1{font-size:clamp(20px,4vw,30px);margin:0 0 12px}
    .card{background:color-mix(in oklab, var(--card) 92%, transparent);border:1px solid color-mix(in oklab, var(--text) 12%, transparent);border-radius:14px;padding:18px;margin:14px 0}
    textarea{width:100%;min-height:140px;border-radius:10px;background:color-mix(in oklab, var(--bg) 92%, white 0%);color:var(--text);border:1px solid color-mix(in oklab, var(--text) 20%, transparent);padding:10px;font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace}
    .btn{appearance:none;border:0;border-radius:10px;padding:8px 12px;background:var(--btn);color:var(--text);font-size:14px;cursor:pointer}
    .btn:hover{background:var(--btnh)}
    .toolbar{display:flex;flex-wrap:wrap;gap:6px;margin:6px 0}
    .toolbar .group{display:flex;flex-wrap:wrap;gap:6px}
    .tabbar{display:flex;gap:8px;flex-wrap:wrap}
    .tab{padding:6px 10px;border-radius:999px;border:1px solid color-mix(in oklab, var(--text) 18%, transparent);cursor:pointer;background:transparent}
    .tab.active{background:color-mix(in oklab, var(--text) 10%, transparent)}
    .muted{color:var(--muted);font-size:13px}
    .actionbar{margin-top:10px;display:flex;gap:8px;flex-wrap:wrap}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .pill{padding:6px 10px;border-radius:999px;border:1px solid color-mix(in oklab, var(--text) 18%, transparent);background:transparent}
    .kbd{display:inline-block;padding:1px 6px;border-radius:6px;border:1px solid color-mix(in oklab, var(--text) 25%, transparent);font-size:12px}
    .output{background:color-mix(in oklab, var(--bg) 92%, white 0%);padding:10px;border-radius:10px;overflow:auto;font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace}
    .hist{display:flex;gap:8px;flex-wrap:wrap}
    .chip{border:1px solid color-mix(in oklab, var(--text) 18%, transparent);padding:6px 8px;border-radius:999px;background:transparent;cursor:pointer}
    .chip:hover{background:color-mix(in oklab, var(--text) 10%, transparent)}
    .tooltip{position:relative}
    .tooltip:hover::after{content:attr(data-tip);position:absolute;left:50%;bottom:120%;transform:translateX(-50%);background:#000c;color:#fff;padding:4px 6px;border-radius:8px;white-space:nowrap;font-size:12px}
  </style>
  <script>
    // MathJaxï¼ˆSVGå‡ºåŠ›ï¼‰
    window.MathJax = { tex:{inlineMath:[["$","$"],["\(","\)"]]}, svg:{fontCache:'local'} };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
</head>
<body>
  <div class="wrap">
    <div class="row" style="justify-content:space-between">
      <h1>æ•°å¼æç”»ãƒ„ãƒ¼ãƒ«</h1>
      <div class="row">
        <button id="themeToggle" class="btn">ğŸŒ— ãƒ†ãƒ¼ãƒ</button>
        <a class="btn" href="index.html">â† PDFãƒ„ãƒ¼ãƒ«ã¸</a>
      </div>
    </div>
    <p class="muted">ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã‹ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ› â†’ å³æ™‚ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã€‚<span class="kbd">âŒ˜/Ctrl</span>+<span class="kbd">Enter</span>ã§æç”»ã€<span class="kbd">âŒ˜/Ctrl</span>+<span class="kbd">C</span>ã§ã‚³ãƒ”ãƒ¼ã€‚</p>

    <div class="card">
      <div class="row">
        <label class="pill"><input type="checkbox" id="displayMode" checked style="accent-color:#6aa9ff"/> $$ ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤è¡¨ç¤º</label>
        <label class="pill"><input type="checkbox" id="autoRender" checked style="accent-color:#6aa9ff"/> å…¥åŠ›ã§è‡ªå‹•æç”»</label>
      </div>

      <div class="tabbar" id="tabbar"></div>
      <div class="toolbar" id="toolbar"></div>

      <textarea id="input" placeholder="ä¾‹ï¼š\int_0^1 x^2\,dx = 
\frac{a+b}{2} 
\sum_{n=1}^N n"></textarea>
      <div class="actionbar">
        <button id="render" class="btn">æç”»</button>
        <button id="copy" class="btn">TeXã‚³ãƒ”ãƒ¼</button>
        <button id="copyWrapped" class="btn tooltip" data-tip="$$...$$ ã§åŒ…ã‚“ã§ã‚³ãƒ”ãƒ¼">$$ ã§ã‚³ãƒ”ãƒ¼</button>
        <button id="saveSvg" class="btn">SVGä¿å­˜</button>
        <button id="savePng" class="btn">PNGä¿å­˜</button>
        <button id="shareUrl" class="btn">URLå…±æœ‰</button>
        <button id="clear" class="btn">ã‚¯ãƒªã‚¢</button>
      </div>
      <p class="muted" style="margin-top:6px">ãƒ’ãƒ³ãƒˆï¼šãƒ†ã‚­ã‚¹ãƒˆã‚’é¸æŠã—ã¦ã‹ã‚‰ <b>åˆ†æ•°/âˆš/æ‹¬å¼§</b> ã‚’æŠ¼ã™ã¨ã€é¸æŠã‚’ä¸­ã«å…¥ã‚Œã¦ãã‚Œã¾ã™ã€‚</p>
    </div>

    <div class="card">
      <h3>ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h3>
      <div id="preview" class="output">ï¼ˆã“ã“ã«æ•°å¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰</div>
    </div>

    <div class="card">
      <h3>ã‚³ãƒ¼ãƒ‰å‡ºåŠ›</h3>
      <div id="output" class="output"></div>
    </div>

    <div class="card">
      <h3>æœ€è¿‘ã®æ•°å¼ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ï¼‰</h3>
      <div id="history" class="hist"></div>
    </div>
  </div>

  <script>
    // ====== ãƒ„ãƒ¼ãƒ«ãƒãƒ¼åˆ†é¡ ======
    const GROUPS = {
      'åŸºæœ¬': [
        {l:'åˆ†æ•°', i:'\frac{}{}'}, {l:'âˆš', i:'\sqrt{}'},
        {l:'^ ä¸Š', i:'^{ }'}, {l:'_ ä¸‹', i:'_{ }'},
        {l:'( )', i:'\left(  \right)'}, {l:'[ ]', i:'\left[  \right]'}, {l:'{ }', i:'\left\{  \right\}'},
        {l:'| |', i:'\left|  \right|'}, {l:'ã€ˆã€‰', i:'\langle  \rangle'}
      ],
      'æ¼”ç®—å­': [
        {l:'âˆ«', i:'\int'}, {l:'âˆ‘', i:'\sum'}, {l:'âˆ', i:'\prod'},
        {l:'lim', i:'\lim'}, {l:'â†’', i:'\rightarrow'}, {l:'â‡’', i:'\Rightarrow'}, {l:'â†¦', i:'\mapsto'},
        {l:'â‰ˆ', i:'\approx'}, {l:'â‰ƒ', i:'\simeq'}, {l:'â‰¡', i:'\equiv'}, {l:'â‰¤', i:'\leq'}, {l:'â‰¥', i:'\geq'}
      ],
      'ã‚®ãƒªã‚·ãƒ£': [
        {l:'Î±', i:'\alpha'}, {l:'Î²', i:'\beta'}, {l:'Î³', i:'\gamma'}, {l:'Î´', i:'\delta'}, {l:'Îµ', i:'\epsilon'},
        {l:'Î¸', i:'\theta'}, {l:'Î»', i:'\lambda'}, {l:'Î¼', i:'\mu'}, {l:'Î½', i:'\nu'}, {l:'Î¾', i:'\xi'},
        {l:'Ï€', i:'\pi'}, {l:'Ï', i:'\rho'}, {l:'Ïƒ', i:'\sigma'}, {l:'Ï„', i:'\tau'}, {l:'Ï†', i:'\phi'}, {l:'Ï‰', i:'\omega'}
      ],
      'æ§‹é€ ': [
        {l:'è¡Œåˆ—2x2', i:'\begin{bmatrix}  &  \  &  \end{bmatrix}'},
        {l:'è¡Œåˆ—3x3', i:'\begin{bmatrix}  &  &  \  &  &  \  &  &  \end{bmatrix}'},
        {l:'cases', i:'\begin{cases}  , & \\  , &  \end{cases}'},
        {l:'åˆ†æ•°ã®å’Œ', i:'\frac{a}{b}+\frac{c}{d}'}, {l:'ãƒ†ã‚¤ãƒ©ãƒ¼', i:'\sum_{n=0}^{\infty} \frac{f^{(n)}(a)}{n!}(x-a)^n'}
      ],
      'ãƒ™ã‚¯ãƒˆãƒ«': [
        {l:'âˆ‚', i:'\partial'}, {l:'âˆ‡', i:'\nabla'}, {l:'â†’ãƒ™ã‚¯ãƒˆãƒ«', i:'\vec{}'}, {l:'ä¸Šç·š', i:'\overline{}'}, {l:'ãƒãƒƒãƒˆ', i:'\hat{}'}
      ]
    };

    const tabbar = document.getElementById('tabbar');
    const toolbar = document.getElementById('toolbar');
    const input = document.getElementById('input');
    const preview = document.getElementById('preview');
    const output = document.getElementById('output');
    const displayMode = document.getElementById('displayMode');

    // ã‚¿ãƒ–ç”Ÿæˆ
    const tabs = Object.keys(GROUPS);
    let activeTab = tabs[0];
    function renderTabs(){
      tabbar.innerHTML='';
      tabs.forEach(t=>{
        const b=document.createElement('button'); b.className='tab'+(t===activeTab?' active':''); b.textContent=t; b.addEventListener('click',()=>{activeTab=t; renderToolbar(); renderTabs();}); tabbar.appendChild(b);
      });
    }
    function renderToolbar(){
      toolbar.innerHTML='';
      const g = GROUPS[activeTab];
      const box = document.createElement('div'); box.className='group';
      g.forEach(k=>{ const b=document.createElement('button'); b.className='btn tooltip'; b.textContent=k.l; b.dataset.insert=k.i; b.dataset.tip=k.i; box.appendChild(b); });
      toolbar.appendChild(box);
    }
    renderTabs(); renderToolbar();

    // ãƒœã‚¿ãƒ³æŒ¿å…¥ï¼ˆé¸æŠã‚’åŒ…ã‚€ï¼‰
    toolbar.addEventListener('click', (e)=>{
      const btn = e.target.closest('button.btn'); if(!btn) return;
      insertTemplate(btn.dataset.insert);
    });

    function insertTemplate(tpl){
      const s=input.selectionStart, e=input.selectionEnd; const sel=input.value.slice(s,e);
      let ins = tpl;
      const wrap = (pre,post)=> pre+(sel||' ')+post;
      if(tpl==='\frac{}{}') ins = `\frac{${sel||' '}}{ }`;
      else if(tpl==='\sqrt{}') ins = wrap('\sqrt{','}');
      else if(tpl==='^{ }') ins = `{${sel||''}}^{ }`;
      else if(tpl==='_{ }') ins = `{${sel||''}}_{ }`;
      else if(tpl==='\left(  \right)') ins = wrap('\left(','\right)');
      else if(tpl==='\left[  \right]') ins = wrap('\left[','\right]');
      else if(tpl==='\left\{  \right\}') ins = wrap('\left\{','\right\}');
      else if(tpl==='\left|  \right|') ins = wrap('\left|','\right|');
      else if(tpl==='\langle  \rangle') ins = wrap('\langle ',' \rangle');
      else if(tpl==='\int') ins = `\int_{ }^{ } ${sel||''}\,`;
      else if(/\(vec|overline|hat)\{\}/.test(tpl)) ins = tpl.replace('{}',`{${sel||' '}}`);
      input.value = input.value.slice(0,s)+ins+input.value.slice(e);
      const pos = s+ins.length; input.focus(); input.selectionStart=input.selectionEnd=pos;
      if(document.getElementById('autoRender').checked) render();
    }

    // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
    function render(){
      const code = input.value;
      const body = displayMode.checked ? `$$${code}$$` : `\(${code}\)`;
      preview.innerHTML = body;
      MathJax.typesetPromise([preview]);
      output.textContent = code;
      saveHistory(code);
    }
    document.getElementById('render').addEventListener('click', render);
    document.getElementById('autoRender').addEventListener('change', ()=>{ if(document.getElementById('autoRender').checked) render(); });
    input.addEventListener('input', ()=>{ if(document.getElementById('autoRender').checked) render(); });

    // ã‚³ãƒ”ãƒ¼
    document.getElementById('copy').addEventListener('click',()=>{ navigator.clipboard.writeText(input.value).then(()=>toast('TeXã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ')); });
    document.getElementById('copyWrapped').addEventListener('click',()=>{
      const code = displayMode.checked ? `$$${input.value}$$` : `\(${input.value}\)`;
      navigator.clipboard.writeText(code).then(()=>toast('åŒ…ã‚“ã TeXã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ')); 
    });

    // ç”»åƒä¿å­˜
    async function currentSVG(){ await MathJax.typesetPromise([preview]); const svg=preview.querySelector('svg'); return svg? svg.outerHTML : null; }
    document.getElementById('saveSvg').addEventListener('click', async()=>{
      const svg=await currentSVG(); if(!svg) return; downloadBlob(new Blob([svg],{type:'image/svg+xml'}),'formula.svg');
    });
    document.getElementById('savePng').addEventListener('click', async()=>{
      const svg=await currentSVG(); if(!svg) return; const img=new Image(); const url=URL.createObjectURL(new Blob([svg],{type:'image/svg+xml'}));
      img.onload=()=>{ const scale=2; const c=document.createElement('canvas'); c.width=img.width*scale; c.height=img.height*scale; const ctx=c.getContext('2d'); ctx.setTransform(scale,0,0,scale,0,0); ctx.drawImage(img,0,0); c.toBlob(b=>{ if(b) downloadBlob(b,'formula.png'); URL.revokeObjectURL(url); },'image/png'); };
      img.src=url;
    });

    // URLå…±æœ‰ï¼ˆãƒãƒƒã‚·ãƒ¥ï¼‰
    function enc(s){return '#q='+encodeURIComponent(s)}
    function dec(){const m=location.hash.match(/^#q=(.*)$/);return m?decodeURIComponent(m[1]):''}
    document.getElementById('shareUrl').addEventListener('click',()=>{ const link=location.origin+location.pathname+enc(input.value); navigator.clipboard.writeText(link).then(()=>toast('å…±æœ‰URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ')); history.replaceState(null,'',enc(input.value)); });
    const q=dec(); if(q){ input.value=q; render(); }

    // å±¥æ­´
    const KEY='math-history-v2'; const histEl=document.getElementById('history');
    function loadHist(){ try{return JSON.parse(localStorage.getItem(KEY)||'[]')}catch{return[]} }
    function saveHistory(code){ if(!code||!code.trim()) return; const list=loadHist().filter(x=>x!==code); list.unshift(code); while(list.length>18) list.pop(); localStorage.setItem(KEY, JSON.stringify(list)); renderHist(); }
    function renderHist(){ const list=loadHist(); histEl.innerHTML=''; list.forEach(s=>{ const b=document.createElement('button'); b.className='chip'; b.textContent=s.length>28? s.slice(0,28)+'â€¦' : s; b.title=s; b.onclick=()=>{ input.value=s; render(); }; histEl.appendChild(b); }); }
    renderHist();

    // ã‚¯ãƒªã‚¢
    document.getElementById('clear').addEventListener('click',()=>{ input.value=''; preview.textContent='ï¼ˆã“ã“ã«æ•°å¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰'; output.textContent=''; toast('ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ'); });

    // ãƒ†ãƒ¼ãƒ
    const themeToggle=document.getElementById('themeToggle');
    function setTheme(t){ document.documentElement.setAttribute('data-theme', t); localStorage.setItem('theme', t); }
    const t0=localStorage.getItem('theme'); if(t0) setTheme(t0);
    themeToggle.addEventListener('click',()=>{ const cur=document.documentElement.getAttribute('data-theme')||'dark'; setTheme(cur==='dark'?'light':'dark'); });

    // util & ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
    function downloadBlob(blob, filename){ const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=filename; a.click(); setTimeout(()=>URL.revokeObjectURL(a.href), 1000); }
    function toast(msg){ const d=document.createElement('div'); d.textContent=msg; d.style.cssText='position:fixed;left:50%;bottom:24px;transform:translateX(-50%);background:#000b;color:#fff;padding:8px 12px;border-radius:10px;z-index:9999'; document.body.appendChild(d); setTimeout(()=>d.remove(),1400); }
    document.addEventListener('keydown',(ev)=>{ if((ev.metaKey||ev.ctrlKey)&&ev.key==='Enter'){ ev.preventDefault(); render(); } if((ev.metaKey||ev.ctrlKey)&&ev.key.toLowerCase()==='c'){ if(document.activeElement===input){ ev.preventDefault(); navigator.clipboard.writeText(input.value).then(()=>toast('TeXã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ')); } } });
  </script>
</body>
</html>
